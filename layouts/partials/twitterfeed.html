<div class="pf-c-card" id="{{ .ID }}">
  <div class="pf-c-card__body">
    <div class="twitterfeed">
      <div>
        <span>Twitter feed for</span>
        <a target="_blank" class="twitterfeed__user__url">
          <span class="twitterfeed__user__name"></span>
          <sup class="twitterfeed__user__followercount"></sup>
        </a>
      </div>

      <ul class="twitterfeed__tweets"></ul>
    </div>
  </div>
</div>

<noscript>Please enable JavaScript to view the Twitter feed.</noscript
><script type="module">
  const base = "{{ .BaseURL }}";
  const username = "{{ .Username }}";

  const twitterFeed = await(
    await fetch(`${base}api/twitter?username=${username}`)
  ).json();

  // User
  document.querySelector("#{{ .ID }} .twitterfeed__user__url").href =
    twitterFeed.userURL;

  document.querySelector("#{{ .ID }} .twitterfeed__user__name").innerText =
    twitterFeed.username;

  document.querySelector(
    "#{{ .ID }} .twitterfeed__user__followercount"
  ).innerText = twitterFeed.userFollowerCount + " Followers";

  // Tweets
  twitterFeed.tweets.map((tweet) => {
    const root = document.createElement("li");

    const link = document.createElement("a");
    link.target = "_blank";
    link.href = tweet.url;

    const avatar = document.createElement("div");

    const userPic = document.createElement("img");
    userPic.src = twitterFeed.userProfilePictureURL;
    userPic.alt = `Profile picture of ${twitterFeed.userDisplayName}`;
    avatar.append(userPic);

    const userDisplayName = document.createElement("span");
    userDisplayName.innerText = twitterFeed.userDisplayName;
    avatar.append(userDisplayName);

    const userName = document.createElement("span");
    userName.innerText = twitterFeed.username;
    avatar.append(userName);

    const tweetTimestamp = document.createElement("span");
    tweetTimestamp.innerText = new Date(tweet.timestamp).toLocaleString();
    avatar.append(tweetTimestamp);

    link.appendChild(avatar);

    const tweetBody = document.createElement("div");
    tweetBody.innerText = tweet.body;

    link.appendChild(tweetBody);

    const images = document.createElement("ul");

    tweet.images.forEach((image) => {
      const li = document.createElement("li");

      const attachment = document.createElement("img");
      attachment.src = image.url;
      attachment.alt = image.altText;
      attachment.style = "max-width: 200px;";

      li.appendChild(attachment);

      images.appendChild(li);
    });

    link.appendChild(images);

    const statistics = document.createElement("div");

    const comments = document.createElement("span");
    comments.textContent = tweet.commentCount + " comments";
    statistics.appendChild(comments);

    const retweets = document.createElement("span");
    retweets.textContent = tweet.retweetCount + " retweets";
    statistics.appendChild(retweets);

    const likes = document.createElement("span");
    likes.textContent = tweet.likeCount + " likes";
    statistics.appendChild(likes);

    link.appendChild(statistics);

    root.appendChild(link);

    document.querySelector("#{{ .ID }} .twitterfeed__tweets").appendChild(root);
  });
</script>
