<a target="_blank" id="last-git-commit"></a>
<noscript>Please enable JavaScript to view the last commit status.</noscript
><script>
  const id = "#last-git-commit";
  const key = "lastGitHubFetch";

  const lastFetch = JSON.parse(window.localStorage.getItem(key) || "{}");

  if (
    !(lastFetch?.payload) ||
    (Date.now() - new Date(lastFetch.created_at).valueOf()) >1000*60*60
  ) {
    fetch("{{ .Site.Params.Commits.GithubAPI }}/users/{{ .Site.Params.Commits.GithubUser }}/events/public")
      .then((res) => res.json())
      .then((data) => {
        const el = document.querySelector(
          id
        )
        el.textContent = `Last FOSS commit: "${data[0].payload.commits[0]?.message.replace(
          /(.{20})..+/,
          "$1 …"
        )}" at ${new Date(data[0].created_at).toLocaleString()}`;
        el.href = "{{ .Site.Params.Commits.GithubHTML }}/"+data[0].repo.name+"/commit/" +  data[0].payload.commits[0]?.sha
        window.localStorage.setItem(key, JSON.stringify(data[0]));
      });
  } else {
    const el = document.querySelector(
      id
    )
    el.textContent = `Last FOSS commit: "${lastFetch.payload.commits[0]?.message.replace(
      /(.{20})..+/,
      "$1 …"
    )}" at ${new Date(lastFetch.created_at).toLocaleString()}`;
    el.href = "{{ .Site.Params.Commits.GithubHTML }}/"+lastFetch.repo.name+"/commit/" +  lastFetch.payload.commits[0]?.sha
  }
</script>
